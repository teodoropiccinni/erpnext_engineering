[
  {
    "doctype": "Client Script",
    "name": "engineering_script_item_item_coding_table_prefix_check",
    "dt": "Item",
    "script_type": "Form",
    "script": "// engineering_script_item_item_coding_table_prefix_check\n// This script handles the visibility of item coding fields in the Item form based on the engineering_field_item_enable_item_coding_prefix field setting.\nfrappe.ui.form.on('Item', {\n    refresh: function(frm) {\n        toggle_item_coding_fields(frm);\n        show_item_name(frm);\n    },\n    engineering_field_item_enable_item_coding_prefix: function(frm) {\n        toggle_item_coding_fields(frm);\n    },\n    engineering_field_item_item_coding_table_link: function(frm) {\n        generate_item_coding_code(frm);\n    }\n});\n// Function to check the flag engineering_field_item_enable_item_coding_prefix and update the view accordingly\nfunction toggle_item_coding_fields(frm) {\n    const show_prefix_list = frm.doc.engineering_field_item_enable_item_coding_prefix;\n    if( show_prefix_list ) {\n        enable_autocode(frm);\n    } else {\n        disable_autocode(frm);\n    }\n    frm.toggle_display('item_name', true); // Always show item name\n}\n// Functions to toggle the visibility of item coding link and Item Code based on the prefix setting\nfunction enable_autocode(frm) {\n    frm.toggle_display('item_code', false);\n    frm.toggle_display('engineering_field_item_item_coding_table_link', true);\n}\nfunction disable_autocode(frm) {\n    frm.toggle_display('item_code', true);\n    frm.toggle_display('engineering_field_item_item_coding_table_link', false);\n}\n// Generate the item_code from the value selected in the item_coding_table_link field and the latest value in database\nfunction generate_item_coding_code(frm) {\n    item_coding_prefix=frm.doc.engineering_field_item_item_coding_table_link;\n    if (item_coding_prefix) {\n        frappe.call({\n            method: \"erpnext_engineering.engineering.doctype.item_coding_table.item_coding_table.generate_item_coding_code\",\n            args: {\n                item_prefix: item_coding_prefix\n            },\n            // Set item_code to the generated code\n            callback: function(r) {\n                frm.set_value('item_code', r.message || \"\");\n            }\n        });\n    } else {\n        frm.set_value('item_code', \"\");\n    }\n}\n",
    "module": "Engineering"
  }
]